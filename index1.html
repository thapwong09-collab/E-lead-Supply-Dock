<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Supplier Check-in</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

  <h2>Supplier Check-in</h2>

  <input id="supplier_name" placeholder="ชื่อบริษัท">
  <button onclick="submitBooking()">Check-in</button>

  <div id="result"></div>

  <script>
    const { createClient } = supabase;

    const supabaseUrl = "https://myonbwhvxoyogwdwgrpq.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15b25id2h2eG95b2d3ZHdncnBxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NzEyMzksImV4cCI6MjA4NzE0NzIzOX0.txYHh142IExZJL8KzMgOOg9g2ZXwqPM33Ci4b1XKVuM";

    const db = createClient(supabaseUrl, supabaseKey);

    async function submitBooking() {

      const supplier_name = document.getElementById("supplier_name").value;

      if (!supplier_name) {
        document.getElementById("result").innerText = "กรุณากรอกชื่อบริษัท";
        return;
      }

      const booking_number = "E" + Date.now();

      const { error } = await db
        .from("bookings")
        .insert([{
          booking_number,
          supplier_name,
          status: "waiting"
        }]);

      if (error) {
        document.getElementById("result").innerText = "เกิดข้อผิดพลาด: " + error.message;
        console.error(error);
      } else {
        document.getElementById("result").innerHTML =
          "เช็คอินสำเร็จ<br>เลขคิวของคุณคือ: " + booking_number +
          "<br>สถานะ: รอเรียก";
      }
    }
  </script>

</body>
</html>